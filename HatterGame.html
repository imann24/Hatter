<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 1</title>
	<script type="text/javascript" src= "js/phaser.min.js"></script>
    <script type="text/javascript" src= "GruntCode.js"></script>
    <script type="text/javascript" src= "PistolCode.js"></script>
    <script type="text/javascript" src= "PlayerCode.js"></script>
    <script type="text/javascript" src= "GUI.js"></script>
    <script type="text/javascript" src= "PreloadCode.js"></script>
    <script type="text/javascript" src= "CreateCode.js"></script>
    <script type="text/javascript" src= "EnvironmentCode.js"></script>
    <script type="text/javascript" src= "HealthCode.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type="text/javascript">

var enemyAlive = true;
var enemiesActive = false;
var gameKeysActive = false;
var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
    preloadSprites();
}


function create() {
    createGameItems();
}

function update() {
    if (countUp() && menuKey.isDown && instructionCounter < instructions.length) {
       changeInstructionText();
    } else if (instructionCounter > 5){
        keyPressItem1.content = '';
        keyPressItem2.content = '';
    }   

    if (pauseKey.isDown) {
        enemiesActive = false;
        gameKeysActive = false;
    } else if (resumeKey.isDown) {
        enemiesActive = true;
        gameKeysActive = true;
        destroyGUI();
    }
    bounceBulletPickUps();
    bounceHealthPickUps();

    for (var i = 0; i < enemies.length; i++) {
       enemies[i].checkEnemyDamage();
    }
    
    game.physics.collide(player, platforms); 
    if (enemiesActive) {
        enemiesActionUpdate();
    } else {
        pauseEnemies();
    }
    enemiesPhysicsUpdate();

    if (playerGun.frame === 5 && fireCounter < 2 && firing === true) {
        fireCounter++;
    } else {
         playerGun.frame = 4;
         firing = false;
         fireCounter = 0;
    }
   
    resetPlayerMovement();

    if (gameKeysActive && cursors.left.isDown) {
        walkLeft();
    } else if (gameKeysActive && cursors.right.isDown) {
        walkRight();
        
    } else {
        playerStop();
    }
 
    //  Allow the player to jump if they are touching the ground.
    if (gameKeysActive && cursors.up.isDown && player.body.touching.down) {
        player.body.velocity.y = -500;
    }

    if (gameKeysActive && cursors.down.isDown && player.body.touching.down === false) {
        player.body.velocity.y = 500;
    }
    if (gameKeysActive && fireKey.isDown) {
        pistolFire(player, playerGun, playerLeft, playerRight, ammoCount, currentWeapon.fireRate);
    }
    if (switchCounter > 10) {
        switchCounter = 0;
    }
    while (gameKeysActive && weaponSwitchKey.isDown && switchCounter === 0) {
        switchWeapon();
        switchCounter++;
    }
    switchCounter++;
    checkPlayerDamage();
    playerHealthMatch();
    
    pistolMatch(player, playerGun, playerLeft, playerRight);
    
    if (playerHealthNum < 1) {
        killPlayer();
    }
    if (pickUpKey.isDown) {
        checkBulletPickUp();  
        checkHealthPickUp(); 
    }
    updateBullets();
    checkForWin();
}

</script>
</body>
</html>
