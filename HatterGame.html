<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 1</title>
	<script type="text/javascript" src= "js/phaser.min.js"></script>
    <script type="text/javascript" src= "GruntCode.js"></script>
    <script type="text/javascript" src= "PistolCode.js"></script>
    <script type="text/javascript" src= "PlayerCode.js"></script>
    <script type="text/javascript" src= "GUI.js"></script>
    <script type="text/javascript" src= "PreloadCode.js"></script>
    <script type="text/javascript" src= "CreateCode.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type="text/javascript">

var enemyAlive = true;

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
    preloadSprites();
}


function create() {
    createGameItems();
}

function update() {
    for (var i = 0; i < bulletItems.length; i++) {
        bulletItems[i].animations.play('bounce');
    }    
   enemyHealthMatch();
   checkPlayerDamage();
   playerHealthMatch();
   if (enemyHealthNum < 7) {
        health.frame = enemyHealthNum;
    }   
    if (playerGun.frame === 5 && fireCounter < 2 && firing === true) {
        fireCounter++;
    } else {
         playerGun.frame = 4;
         firing = false;
         fireCounter = 0;
    }
   playerLeft = false;
   playerRight = false;

    //  Collide the player and the stars with the platforms
    game.physics.collide(player, platforms);
    game.physics.collide(enemy, platforms);
 
  //  Reset the players velocity (movement)
    player.body.velocity.x = 0;
   

    if (cursors.left.isDown) {
        //  Move to the left
        player.body.velocity.x = -150;
        player.animations.play('left');
        playerLeft = true;
    } else if (cursors.right.isDown) {
        //  Move to the right
        player.body.velocity.x = 150;
 
        player.animations.play('right');
        playerRight = true;
    } else {
        //  Stand still
        player.animations.stop();
        player.frame = 6;
    }
 
    //  Allow the player to jump if they are touching the ground.
    if (cursors.up.isDown && player.body.touching.down) {
        player.body.velocity.y = -500;  
    }

    if (cursors.down.isDown && player.body.touching.down === false) {
        player.body.velocity.y = 500;
    }
    if (fireKey.isDown) {
        pistolFire(player, playerGun, playerLeft, playerRight, ammoCount);
    }
    //makes sure the pistols are displaying the proper frame 
    pistolMatch(player, playerGun, playerLeft, playerRight);
    pistolMatch(enemy, enemyGun, goingLeft, goingRight);

    if (goingRight === true) {
       walkRight(enemy);
    } 
    if (enemy.x >= 700) {
        goingLeft = true;
        goingRight = false;
    }

    if(goingLeft === true) { 
        walkLeft(enemy);
    } 
    if (enemy.x <= 100) {
        goingRight = true;
        goingLeft = false;
    }

    enemyAmmoReplenish();
    game.physics.overlap (enemy, bullets, damageEnemy, null, this);
    if (enemyHealthNum === 7) {
         killEnemy(enemy, enemyGun);
    }
    //player.y === enemy.y && Math.abs(player.x - enemy.x) < 300
    if (facingPlayer() && enemyAlive) {
        pistolFire(enemy, enemyGun, goingLeft, goingRight, enemyAmmo);
    }

    checkBulletPickUp();   
    updateBullets();
}
</script>
</body>
</html>
